<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Internal Transfer</title>
    <style>
        body {
            font-family: Microsoft JhengHei;
            background-color: #F9F9FC;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: auto;
        }

        h1 {
            text-align: center;
            color: #000000;
            margin-bottom: 20px;
            padding-left: 20px;
            padding-right: 20px;
        }

        .intro-section {
            padding: 20px;
            margin-top: 40px;
            margin-bottom: 40px;
            text-align: left;
            background-color: #F1F4F9;
        }
        
        .section-title {
            text-align: left;
            color: #5B5B5B;
            margin-top: 0;
            margin-bottom: 10px;
            border-bottom: 1px solid #5B5B5B;
            padding-bottom: 10px;
            padding-left: 20px;
            padding-right: 20px;
        }
        
        .intro-text {
            color: #5B5B5B;
            font-size: 1.0em;
            margin-bottom: 0;
            line-height: 1.6;
            padding-left: 0;
            padding-right: 0;
        }

        .highlight {
            color: #007AB5;
            font-weight: bold;
        }

        .job-card {
            background-color: #fff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            border: 1px solid #E9ECEF;
            margin-bottom: 20px;
            margin-left: 20px;
            margin-right: 20px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .job-card h2 {
            color: #007AB5;
            margin: 0;
        }

        .department {
            font-weight: bold;
            color: #007AB5;
            font-size: 1.1em;
            white-space: nowrap;
            text-align: right;
        }

        .job-card .summary {
            color: #000000;
            line-height: 1.8;
            font-size: 1em;
        }

        .job-card .more-info {
            display: none;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px dashed #5B5B5B;
        }

        .job-card .more-info h3 {
            margin-top: 0;
            color: #000000;
        }

        .job-card ul {
            padding-left: 20px;
            margin-bottom: 10px;
        }

        .job-card button {
            background-color: #DCDDDF;
            color: #000000;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }

        .job-card button:hover {
            background-color: #007AB5;
        }

        .language-switcher {
            text-align: right;
            padding: 20px 20px 0 0;
        }

        .language-switcher button {
            background-color: #DCDDDF;
            color: #000000;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-left: 5px;
        }

        .language-switcher button.active {
            background-color: #007AB5;
            color: #fff;
        }

        .lang-en { display: block; }
        .lang-zh { display: none; }

        .forms-section {
            padding: 20px;
            margin-top: 40px;
            text-align: center;
            background-color: #D1E9E9;
        }
        
        .forms-section h2 {
            color: #000000;
            border-bottom: none;
            text-align: center;
            margin-bottom: 0;
        }

        .forms-section .links {
            color: #000000;
            line-height: 1.6;
            border-bottom: none;
            text-align: center;
            margin-bottom: 20px;
            font-size: 0.9em;
        }

        .search-and-filter-bar {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px;
            align-items: center;
        }

        .search-and-filter-bar input,
        .search-and-filter-bar select {
            padding: 8px 12px;
            border: 1px solid;
            border-radius: 5px;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .search-and-filter-bar input:focus,
        .search-and-filter-bar select:focus {
            outline: none;
            border-color: #007AB5;
            box-shadow: 0 0 5px rgba(0, 122, 181, 0.5);
        }

        .search-and-filter-bar input {
            flex: 1;
            min-width: 200px;
        }

        #scrollToTopBtn {
            display: none;
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 99;
            font-size: 18px;
            border: none;
            outline: none;
            background-color: #007AB5;
            color: white;
            cursor: pointer;
            padding: 10px 15px;
            border-radius: 50%;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: all 0.3s ease-in-out;
        }
        #scrollToTopBtn:hover {
            background-color: #1B2D56;
        }
        .result-count {
            padding: 0 20px;
            margin-top: 10px;
            margin-bottom: 10px;
        }
        @media (max-width: 768px) {
            .result-count {
                padding: 0 10px;
            }
        }
    </style>
</head>
<body>
    <div class="language-switcher">
        <button id="lang-en-btn">English</button>
        <button id="lang-zh-btn">繁體中文</button>
    </div>

    <div class="lang-en">
        <h1>Internal Transfer</h1>
    </div>
    <div class="lang-zh">
        <h1>內部轉調</h1>
    </div>

    <div class="intro-section">
        <div class="lang-en">
            <h2 class="section-title">Requirements</h2>
        </div>
        <div class="lang-zh">
            <h2 class="section-title">應徵資格</h2>
        </div>

        <div class="lang-en">
            <p class="intro-text">
                If the employee applicant meets the <span class="highlight">minimum competencies</span> for the position, the employee applicant will be scheduled to interview with the hiring manager. <br>
                In addition to meeting the minimum competencies for the position, employee applicant must meet the following criteria : <br>
                1.  The employee applicant must be in the current position for <span class="highlight">12 months</span>. <br>
                2.  The employee applicant must be rated as <span class="highlight">S(Satisfactory)</span> or above in the latest performance rating cycle. <br>
                3.  An employee applicant on a <span class="highlight">Performance Improvement Plan(PIP)</span> may <span class="highlight">not</span> apply for a new position or transfer.
            </p>
        </div>
        <div class="lang-zh">
            <p class="intro-text">
                如果員工申請人符合該職位的<span class="highlight">基本能力要求</span>，將被安排與招聘經理進行面試。
                除了符合職位的基本能力要求外，員工申請人還必須符合以下標準：<br>
                1.  員工申請人必須在現職位服務滿<span class="highlight">十二個月</span>。<br>
                2.  員工申請人在最近一次績效評估週期中，必須被評定為 <span class="highlight">S(滿意)</span> 或以上。<br>
                3.  正在執行<span class="highlight">績效改進計畫(PIP)</span>的員工申請人<span class="highlight">不得</span>申請新職位或轉調。
            </p>
        </div>
    </div>

    <div class="search-and-filter-bar">
        <div class="lang-en">
            <input type="text" id="searchInput" placeholder="Search for jobs..." oninput="filterAndSearch()">
            <select id="departmentFilter" onchange="filterAndSearch()">
                <option value="all">All Departments</option>
            </select>
            <select id="durationFilter" onchange="filterAndSearch()">
                <option value="all">All Durations</option>
                </select>
            <select id="gradeFilter" onchange="filterAndSearch()">
                <option value="all">All Grades</option>
                </select>
        </div>
        <div class="lang-zh">
            <input type="text" id="searchInputZh" placeholder="搜尋職位..." oninput="filterAndSearch()">
            <select id="departmentFilterZh" onchange="filterAndSearch()">
                <option value="all">所有部門</option>
                </select>
            <select id="durationFilterZh" onchange="filterAndSearch()">
                <option value="all">所有性質</option>
                </select>
            <select id="gradeFilterZh" onchange="filterAndSearch()">
                <option value="all">所有職等</option>
                </select>
        </div>
    </div>
    
    <div class="lang-en result-count" id="result-count-en"></div>
    <div class="lang-zh result-count" id="result-count-zh"></div>
    
    <div id="job-listings"></div>

    <div class="forms-section">
        <div class="lang-en">
            <h2 class="section-title">Application Form</h2>
        </div>
        <div class="lang-zh">
            <h2 class="section-title">內轉申請表</h2>
        </div>

        <p class="links lang-en">
            If the form does not display as expected, please refer to 
            <a href="https://forms.office.com/Pages/ResponsePage.aspx?id=NVi7uIB-zEuXaN8PQviID9ahXQ2Y9QZDiPDefAVXMrRUOVNKR0JIWkM2S0dISVgwVEcwWTM2OU9CQS4u" target="_blank">
            this page</a>.
            
        </p>
        <p class="links lang-zh">
            如果申請表沒有如期顯示，請點擊
            <a href="https://forms.office.com/Pages/ResponsePage.aspx?id=NVi7uIB-zEuXaN8PQviID9ahXQ2Y9QZDiPDefAVXMrRUOVNKR0JIWkM2S0dISVgwVEcwWTM2OU9CQS4u" target="_blank">
            頁面跳轉</a>
            。
        </p>
        
        <iframe width="640px" height="480px" src="https://forms.office.com/Pages/ResponsePage.aspx?id=NVi7uIB-zEuXaN8PQviID9ahXQ2Y9QZDiPDefAVXMrRUOVNKR0JIWkM2S0dISVgwVEcwWTM2OU9CQS4u&embed=true&lang=en" frameborder="0" marginwidth="0" marginheight="0" style="border: none; max-width:100%; max-height:100vh" allowfullscreen webkitallowfullscreen mozallowfullscreen msallowfullscreen> </iframe>
    
    </div>

    <button id="scrollToTopBtn" title="Go to top">▲</button>

<script>
    let allJobs = [];

    function populateFilters() {
        const departments = [...new Set(allJobs.map(job => job.department))].sort();
        const durations = [...new Set(allJobs.map(job => job.duration))].sort();
        const grades = [...new Set(allJobs.map(job => job.grade))].sort();

        const departmentFilterEn = document.getElementById('departmentFilter');
        const durationFilterEn = document.getElementById('durationFilter');
        const gradeFilterEn = document.getElementById('gradeFilter');
        const departmentFilterZh = document.getElementById('departmentFilterZh');
        const durationFilterZh = document.getElementById('durationFilterZh');
        const gradeFilterZh = document.getElementById('gradeFilterZh');

        departments.forEach(dept => {
            const optionEn = document.createElement('option');
            optionEn.value = dept;
            optionEn.textContent = dept;
            departmentFilterEn.appendChild(optionEn);

            const optionZh = document.createElement('option');
            optionZh.value = dept;
            optionZh.textContent = allJobs.find(job => job.department === dept).department_zh;
            departmentFilterZh.appendChild(optionZh);
        });

        durations.forEach(dur => {
            const optionEn = document.createElement('option');
            optionEn.value = dur;
            optionEn.textContent = dur;
            durationFilterEn.appendChild(optionEn);

            const optionZh = document.createElement('option');
            optionZh.value = dur;
            optionZh.textContent = allJobs.find(job => job.duration === dur).duration_zh;
            durationFilterZh.appendChild(optionZh);
        });

        grades.forEach(grade => {
            const optionEn = document.createElement('option');
            optionEn.value = grade;
            optionEn.textContent = grade;
            gradeFilterEn.appendChild(optionEn);

            const optionZh = document.createElement('option');
            optionZh.value = grade;
            optionZh.textContent = allJobs.find(job => job.grade === grade).grade_zh;
            gradeFilterZh.appendChild(optionZh);
        });
    }

    function setLanguage(lang) {
        document.documentElement.lang = lang;
        localStorage.setItem('lang', lang);

        if (lang === 'zh-TW') {
            document.querySelectorAll('.lang-en').forEach(el => el.style.display = 'none');
            document.querySelectorAll('.lang-zh').forEach(el => el.style.display = 'block');
            document.getElementById('lang-zh-btn').classList.add('active');
            document.getElementById('lang-en-btn').classList.remove('active');
        } else {
            document.querySelectorAll('.lang-en').forEach(el => el.style.display = 'block');
            document.querySelectorAll('.lang-zh').forEach(el => el.style.display = 'none');
            document.getElementById('lang-en-btn').classList.add('active');
            document.getElementById('lang-zh-btn').classList.remove('active');
        }
        filterAndSearch();
    }

    async function fetchJobs() {
        try {
            const response = await fetch('jobs.json');
            allJobs = await response.json();
            populateFilters();
            renderJobCards(allJobs);
        } catch (error) {
            console.error('Failed to fetch jobs:', error);
        }
    }

    function renderJobCards(jobs) {
        const jobListingsContainer = document.getElementById('job-listings');
        jobListingsContainer.innerHTML = '';
        
        jobs.forEach(job => {
            const card = document.createElement('div');
            card.className = 'job-card';
            card.setAttribute('data-department', job.department);
            card.setAttribute('data-duration', job.duration);
            card.setAttribute('data-grade', job.grade);
            
            card.innerHTML = `
                <div class="card-header">
                    <div class="lang-en">
                        <h2>${job.title_en}</h2>
                    </div>
                    <div class="lang-zh">
                        <h2>${job.title_zh}</h2>
                    </div>
                    <span class="department lang-en">${job.department}</span>
                    <span class="department lang-zh">${job.department_zh}</span>
                </div>
                <div class="lang-en">
                    <p class="summary">
                        <span class="highlight">${job.duration}</span><br>
                        <span class="highlight">Job Grade : ${job.grade}</span><br>
                        ${job.summary_en}
                    </p>
                    <button onclick="toggleInfo('${job.id}')">more info</button>
                </div>
                <div class="lang-zh">
                    <p class="summary">
                        <span class="highlight">${job.duration_zh}</span><br>
                        <span class="highlight">職等：${job.grade_zh}</span><br>
                        ${job.summary_zh}
                    </p>
                    <button onclick="toggleInfo('${job.id}')">了解更多</button>
                </div>
                
                <div id="${job.id}" class="more-info">
                    <div class="lang-en">
                        <h3>Job Description</h3>
                        <ul>
                            ${job.description_en.map(item => `<li>${item}</li>`).join('')}
                        </ul>
                        <h3>Required skills</h3>
                        <p>${job.skills_en}</p>
                        <h3>Hiring Manager</h3>
                        <p>${job.hiring_manager}</p>
                    </div>
                    <div class="lang-zh">
                        <h3>工作內容</h3>
                        <ul>
                            ${job.description_zh.map(item => `<li>${item}</li>`).join('')}
                        </ul>
                        <h3>所需技能</h3>
                        <p>${job.skills_zh}</p>
                        <h3>招聘主管</h3>
                        <p>${job.hiring_manager}</p>
                    </div>
                </div>
            `;
            jobListingsContainer.appendChild(card);
        });

        setLanguage(document.documentElement.lang);
    }

    window.onload = function() {
        const savedLang = localStorage.getItem('lang') || 'en';
        setLanguage(savedLang);
        fetchJobs(); 

        document.getElementById('lang-en-btn').addEventListener('click', () => setLanguage('en'));
        document.getElementById('lang-zh-btn').addEventListener('click', () => setLanguage('zh-TW'));
    };

    function toggleInfo(id) {
        const element = document.getElementById(id);
        if (element.style.display === "none" || element.style.display === "") {
            element.style.display = "block";
        } else {
            element.style.display = "none";
        }
    }
    
    const scrollToTopBtn = document.getElementById("scrollToTopBtn");
    window.onscroll = function() {
        if (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) {
            scrollToTopBtn.style.display = "block";
        } else {
            scrollToTopBtn.style.display = "none";
        }
    };

    scrollToTopBtn.addEventListener("click", () => {
        window.scrollTo({
            top: 0,
            behavior: 'smooth'
        });
    });

    function filterAndSearch() {
        const isEnglish = document.documentElement.lang === 'en';
        
        const searchInput = isEnglish ? document.getElementById('searchInput').value.toLowerCase() : document.getElementById('searchInputZh').value.toLowerCase();
        
        const departmentFilterElement = isEnglish ? document.getElementById('departmentFilter') : document.getElementById('departmentFilterZh');
        const durationFilterElement = isEnglish ? document.getElementById('durationFilter') : document.getElementById('durationFilterZh');
        const gradeFilterElement = isEnglish ? document.getElementById('gradeFilter') : document.getElementById('gradeFilterZh');

        const departmentFilter = departmentFilterElement.value;
        const durationFilter = durationFilterElement.value;
        const gradeFilter = gradeFilterElement.value;

        const filteredJobs = allJobs.filter(job => {
            const cardText = JSON.stringify(isEnglish ? job : { ...job, department: job.department_zh, duration: job.duration_zh, grade: job.grade_zh, title: job.title_zh, summary: job.summary_zh, description: job.description_zh, skills: job.skills_zh }).toLowerCase();
            const matchesSearch = cardText.includes(searchInput);
            const matchesDepartment = departmentFilter === 'all' || (isEnglish ? job.department === departmentFilter : job.department_zh === departmentFilter);
            const matchesDuration = durationFilter === 'all' || (isEnglish ? job.duration.includes(durationFilter) : job.duration_zh.includes(durationFilter));
            const matchesGrade = gradeFilter === 'all' || (isEnglish ? job.grade === gradeFilter : job.grade_zh === gradeFilter);
            
            return matchesSearch && matchesDepartment && matchesDuration && matchesGrade;
        });

        renderJobCards(filteredJobs);

        const resultCountEn = document.getElementById('result-count-en');
        const resultCountZh = document.getElementById('result-count-zh');
        
        if (isEnglish) {
            resultCountEn.textContent = `${filteredJobs.length} job(s) found.`;
            resultCountZh.textContent = '';
        } else {
            resultCountZh.textContent = `找到 ${filteredJobs.length} 個職位。`;
            resultCountEn.textContent = '';
        }
    }
</script>
</body>
</html>
